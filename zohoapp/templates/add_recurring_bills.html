{% extends 'base.html' %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<style>

    input[type=text], select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
    }
    
    label {
      padding: 12px 12px 12px 0;
      display: inline-block;
    }
    
    
    .row:after {
      content: "";
      display: table;
      clear: both;
    }
    
    @media screen and (max-width: 600px) {
      .col-25, .col-75, input[type=submit] {
        width: 100%;
        margin-top: 0;
      }
      input[type=text], select, textarea {
      width: 100%;

    }
    }

    .dropdown input,
    .dropdown button {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
    }

    .dropdown.open input,
    .dropdown.open button {
      display: block;
    }
    </style>


<div class="container-fulid containerprof">

    <div class="card radius-15 p-5">
      <div class="card-body">
          <div class="card-title">
            <h2 class="mb-0 text-uppercase text-right"><i class="fa fa-receipt"></i> &nbsp; New Recurring Bills</h2>
          </div>
      </div>
    </div>

    <div class="card radius-15 p-5">
    <form action="">

      <div class="row">
        <div class="col-md-3">
          <label style="color: rgb(190, 88, 88);">Vendor Name *</label><br>
        </div>
        <div class="col-md-6">
          <select name="vendor" id="vendor" class="form-control" >
            <option value=""></option>
            {% for v in vendor %}
            <option value="{{ v.first_name }} {{ v.last_name }} {{v.id}}">{{ v.first_name }} {{ v.last_name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-10 p-5">
          <label class="d-none" id="email_lbl" style="color: grey;"></label>
          <label class="d-none" id="gst_trt_lbl" style="color: grey;"></label>
          <label class="d-none" id="gstin_lbl" style="color: grey;"></label>
        </div>
      </div>

      <div class="row">
        <div class="col-md-3">
          <label style="color: rgb(190, 88, 88);">Source of Supply*</label>
        </div>

        <div class="col-md-6">
            <select name="srcofsupply" id="" class="form-control">
                <option value="[AN] Andaman and Nicobar Islads">[AN] Andaman and Nicobar Islads</option>
                <option value="[AD] Andhra Predhesh">[AD] Andhra Predhesh</option>
                <option value="[AR] Arunachal Predesh">[AR] Arunachal Predesh</option>
                <option value="[AS] Assam">[AS] Assam</option>
                <option value="[BR] Bihar">[BR] Bihar</option>
                <option value="[CH] Chandigarh">[CH] Chandigarh</option>
                <option value="[CG] Chhattisgarh">[CG] Chhattisgarh</option>
                <option value="[DNH] Dadra and Nagar Haveli">[DNH] Dadra and Nagar Haveli</option>
                <option value="[DD] Damn anad Diu">[DD] Damn anad Diu</option>
                <option value="[DL] Delhi">[DL] Delhi</option>
                <option value="[GA] Goa">[GA] Goa</option>
                <option value="[GJ] Gujarat">[GJ] Gujarat</option>
                <option value="[HR] Haryana">[HR] Haryana</option>
                <option value="[HP] Himachal Predesh">[HP] Himachal Predesh</option>
                <option value="[JK] Jammu and Kashmir">[JK] Jammu and Kashmir</option>
                <option value="[JH] Jharkhand">[JH] Jharkhand</option>
                <option value="[KA] Karnataka">[KA] Karnataka</option>
                <option selected="selected" value="[KL] Kerala">[KL] Kerala</option>
                <option value="[LA] Ladakh">[LA] Ladakh</option>
                <option value="[LD] Lakshadweep">[LD] Lakshadweep</option>
                <option value="[MP] Madhya Predesh">[MP] Madhya Predesh</option>
                <option value="[MH] Maharashtra">[MH] Maharashtra</option>
                <option value="[MN] Manipur">[MN] Manipur</option>
                <option value="[ML] Meghalaya">[ML] Meghalaya</option>
                <option value="[MZ] Mizoram">[MZ] Mizoram</option>
                <option value="[NL] Nagaland">[NL] Nagaland</option>
                <option value="[OD] Odisha">[OD] Odisha</option>
                <option value="[PY] Puducherry">[PY] Puducherry</option>
                <option value="[PB] Punjab">[PB] Punjab</option>
                <option value="[RJ] Rajasthan">[RJ] Rajasthan</option>
                <option value="[SK] Sikkim">[SK] Sikkim</option>
                <option value="[TN] Tamil Nadu">[TN] Tamil Nadu</option>
                <option value="[TS] Telangana">[TS] Telangana</option>
                <option value="[TR] Tripura">[TR] Tripura</option>
                <option value="[UP] Uttar Predesh">[UP] Uttar Predesh</option>
                <option value="[UK] Uttarakhand">[UK] Uttarakhand</option>
                <option value="[WB] West Bengal">[WB] West Bengal</option>
                <option value="[OT] Other Territory">[OT] Other Territory</option>
            </select>
            
        </div>

      </div>
      <div class="row">
        <div class="col-md-3">
          <label style="color: rgb(190, 88, 88);">Destination of Supply*</label>
        </div>

        <div class="col-md-6">
            <select name="dstnofsupply" id="" class="form-control">
                <option value="[AN] Andaman and Nicobar Islads">[AN] Andaman and Nicobar Islads</option>
                <option value="[AD] Andhra Predhesh">[AD] Andhra Predhesh</option>
                <option value="[AR] Arunachal Predesh">[AR] Arunachal Predesh</option>
                <option value="[AS] Assam">[AS] Assam</option>
                <option value="[BR] Bihar">[BR] Bihar</option>
                <option value="[CH] Chandigarh">[CH] Chandigarh</option>
                <option value="[CG] Chhattisgarh">[CG] Chhattisgarh</option>
                <option value="[DNH] Dadra and Nagar Haveli">[DNH] Dadra and Nagar Haveli</option>
                <option value="[DD] Damn anad Diu">[DD] Damn anad Diu</option>
                <option value="[DL] Delhi">[DL] Delhi</option>
                <option value="[GA] Goa">[GA] Goa</option>
                <option value="[GJ] Gujarat">[GJ] Gujarat</option>
                <option value="[HR] Haryana">[HR] Haryana</option>
                <option value="[HP] Himachal Predesh">[HP] Himachal Predesh</option>
                <option value="[JK] Jammu and Kashmir">[JK] Jammu and Kashmir</option>
                <option value="[JH] Jharkhand">[JH] Jharkhand</option>
                <option value="[KA] Karnataka">[KA] Karnataka</option>
                <option selected="selected" value="[KL] Kerala">[KL] Kerala</option>
                <option value="[LA] Ladakh">[LA] Ladakh</option>
                <option value="[LD] Lakshadweep">[LD] Lakshadweep</option>
                <option value="[MP] Madhya Predesh">[MP] Madhya Predesh</option>
                <option value="[MH] Maharashtra">[MH] Maharashtra</option>
                <option value="[MN] Manipur">[MN] Manipur</option>
                <option value="[ML] Meghalaya">[ML] Meghalaya</option>
                <option value="[MZ] Mizoram">[MZ] Mizoram</option>
                <option value="[NL] Nagaland">[NL] Nagaland</option>
                <option value="[OD] Odisha">[OD] Odisha</option>
                <option value="[PY] Puducherry">[PY] Puducherry</option>
                <option value="[PB] Punjab">[PB] Punjab</option>
                <option value="[RJ] Rajasthan">[RJ] Rajasthan</option>
                <option value="[SK] Sikkim">[SK] Sikkim</option>
                <option value="[TN] Tamil Nadu">[TN] Tamil Nadu</option>
                <option value="[TS] Telangana">[TS] Telangana</option>
                <option value="[TR] Tripura">[TR] Tripura</option>
                <option value="[UP] Uttar Predesh">[UP] Uttar Predesh</option>
                <option value="[UK] Uttarakhand">[UK] Uttarakhand</option>
                <option value="[WB] West Bengal">[WB] West Bengal</option>
                <option value="[OT] Other Territory">[OT] Other Territory</option>
            </select>
        </div>
      </div>
      <br><br>

      <div class="row">
        <div class="col-md-3">
          <label for="prof_name" style="color: rgb(190, 88, 88);">Profile Name *</label>
        </div>

        <div class="col-md-6">
          <input type="text" class="form-control" required id="prof_name" name="prof_name">
        </div>
      </div>

      <div class="row">
        <div class="col-md-3">
          <label for="" style="color: rgb(190, 88, 88);">Repeat Every *</label>
        </div>

        <div class="col-md-6">
          <div class="d-flex">
            <select class="form-control" required name="repeat">

                <option selected value="1 Week">Week</option>
                <option value="2 Weeks">2 Weeks</option>
                <option value="1 Month">Month</option>
                <option value="2 Months">2 Months</option>
                <option value="3 Months">3 Months</option>
                <option value="6 Months">6 Months</option>
                <option value="1 Year">Years</option>
                <option value="2 Years">2 Years</option>
                <option value="3 Years">3 Years</option>
                <option value="6 Years">6 Years</option>
            </select>
          </div>   
        </div>
      </div>
      <br><br>


      <div class="row">
          <div class="col-md-3">
            <label for="date1">Starts On</label>
          </div>
          <div class="col-md-3">
            <input type="date" class="form-control" required id="date1" name="start_date">
          </div>
      </div>
      <div class="row">
        <div class="col-md-3">
          <label for="date2">Ends On</label>
        </div>
        <div class="col-md-3">
          <input type="date" class="form-control" required id="date2" name="end_date">
        </div>
        <div class="col-md-3">
          <input type="checkbox" id="never-expire-checkbox" onchange="toggleDateInput()" />
          <label for="never-expire-checkbox" style="color: #909091;" name="neverExp">Never Expires</label>
        </div>
      </div>


      <div class="row">
        <div class="col-md-3">
          <label for="date2">Payment Terms</label>
        </div>
        <div class="col-md-6">
          <div class="d-flex">
            <select class="form-control" id="terms" required name="terms">

                <option selected value="15">NET 15</option>
                <option value="30">NET 30</option>
                <option value="45">NET 45</option>
                <option value="60">NET 60</option>
                <option value="90">NET 90</option>
                <option value="">Due end of the month</option>
                <option value="recpt">Due on receipt</option>
            </select>
          </div>   
        </div>
      </div>  

      <div class="row mb-5">
        <div class="col-md-3">
          <label for="">Reverse Charge</label>
        </div>
        <div class="col-md-6">
          <input type="checkbox" id="rvsCharge" name="rvsCharge" onchange="saveCheckboxValue()">
          <label for="rvsCharge" class="mx-3 mt-2">This transaction is applicable for Reverse Charge</label>
        </div>
      </div>

      <div class="row">
        <div class="col-md-3">
          <label style="color: rgb(190, 88, 88);">Customer Name *</label><br>
        </div>
        <div class="col-md-6">
          <select name="customer" id="customer" class="form-control" >
            <option value=""></option>
            {% for c in customer %}
            <option value="{{ c.customerName }} {{c.id}}">{{ c.customerName }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-10 p-5">
          <label class="d-none" id="cemail_lbl" style="color: grey;"></label>
          <label class="d-none" id="comp_lbl" style="color: grey;"></label>
          <label class="d-none" id="cgst_trt_lbl" style="color: grey;"></label>
        </div>

      </div>

      <div class="row">
        <div class="col-md-12 table-responsive-md mt-3">
          <table class="table table-bordered table-hover mt-3" id="tab_logic">
            <thead>
              <tr>
                <th class="text-center text-uppercase">Item Details</th>
                <th class="text-center text-uppercase">account</th>
                <th class="text-center text-uppercase">quantity</th>
                <th class="text-center text-uppercase">rate</th>
                <th class="text-center text-uppercase">tax</th>
                <th class="text-center text-uppercase">discount</th>
                <th class="text-center text-uppercase">amount</th>
              </tr>
            </thead>
            <tbody id="items-table-body">
              <tr>
                <td style="width: 20%;">
                  <div class="d-flex">
                    <select name='item[]' id="item" class="form-control">
                      <option value=" " selected disabled>Select Item</option>
                      {% for i in item %}
                        <option value="{{ i.name  }}">{{ i.name  }} </option>
                      {% endfor %}
                    </select>
                  </div>  
                </td>
                <td  style="width: 20%;">
                  <div class="d-flex">
                    <select name='account[]' id="account" class="form-control">
                      <option value=" " selected disabled >Select Account</option>
                      <hr>
                      {% for i in account %}
                          <option value="{{ i.accountName }}">{{ i.accountName  }} </option>
                      {% endfor %}
                    </select>
                  </div>  
                </td>
                <td style="width: 10%;">
                  <input type="number" name='qty[]' onchange="qtychange1(this)" placeholder='Qty' id="qty1"  class="form-control qty" step=0 min=0/>
                </td>
                <td style="width: 10%;">
                  <input type="text" name='rate[]' id="rate" placeholder='Rate' class="form-control" />
                </td>
                <td style="width: 16%;">
                  <select name="tax[]" id="tax1" class="form-control tax">
                    <option id="ta1" value=0 text={{ cmp1.state }} disabled>Choose</option>
                    <option value=28 text={{ cmp1.state }}>28.0% GST(28%)</option>
                    <option value=18 text={{ cmp1.state }}>18.0% GST(18%)</option>
                    <option value=12 text={{ cmp1.state }}>12.0% GST(12%)</option>
                    <option value=6 text={{ cmp1.state }}>06.0% GST(06%)</option>
                    <option value=5 text={{ cmp1.state }}>05.0% GST(05%)</option>
                    <option value=3 text={{ cmp1.state }}>03.0% GST(03%)</option>
                    <option value=.25 text={{ cmp1.state }}>0.25% GST(0.25%)</option>
                    <option value=0 text={{ cmp1.state }}>0.0% GST(0%)</option>
                    <option value=0 text={{ cmp1.state }}>Exempt GST(0%)</option>
                    <option value=0 text={{ cmp1.state }}>Out of Scope(0%)</option>
                    <option id="ta5" value=0 text=" " disabled>Choose</option>
                    <option value=28 text=" ">28.0% IGST(28%)</option>
                    <option value=18 text=" ">18.0% IGST(18%)</option>
                    <option value=12 text=" ">12.0% IGST(12%)</option>
                    <option value=6 text=" ">06.0% IGST(06%)</option>
                    <option value=5 text=" ">05.0% IGST(05%)</option>
                    <option value=3 text=" ">03.0% IGST(03%)</option>
                    <option value=.25 text=" ">0.25% IGST(0.25%)</option>
                    <option value=0 text=" ">0.0% IGST(0%)</option>
                    <option value=0 text=" ">Exempt IGST(0%)</option>
                    <option value=0 text=" ">Out of Scope(0%)</option>
                  </select>
                </td>
                <td style="width: 11%;">
                  <input type="text" name='discount[]' id="discount" placeholder='Discount' class="form-control"/>
                </td>
                <td style="width: 11%;">
                  <input type="text" name='amount[]' id="amount" placeholder='Amount' class="form-control price" step="0.00" min="0"  />
                </td>
                <td style="display: none;">
                  <input type="number" step="any" name='taxamount1' id="taxamount1" class="form-control taxamount"/>
                </td>   
              </tr>
            </tbody>
            <tr>
                <td style="border: none;"><a class="btn btn-outline-secondary ml-1" role="button" id="add"  title="Add Row">+</a></td>
            </tr>
          </table>
        </div>
      </div>
      
      <div class="row mt-5">
        <center>
          <button type="submit" class="btn save_btn text-align-center font-weight-bold mt-2" 
                          style="width: 200px; text-align: center ;"> SAVE CHANGES</button>
        </center>
      </div>
    </form>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>
  function toggleDateInput() {
      var checkbox = document.getElementById("never-expire-checkbox");
      var dateInput = document.getElementById("date2");
      
      if (checkbox.checked) {
          dateInput.disabled = true;
          $("#terms").val("recpt");
      } 
      else {
          dateInput.disabled = false;
      }
  }

  $(document).ready(function() {
    $('#terms').change(function() {
      var va = $(this).val();
      var checkbox = $('#never-expire-checkbox')[0];
      if (va == 'recpt'){
        checkbox.checked = true;
        $('#date2')[0].disabled = true;
      }
      else{
        checkbox.checked = false;
        $('#date2').disabled = false;
      }
      });
  });




$(document).ready(function() {
    $('#vendor').change(function() {

        var name = $("#vendor").val();
        var na = name.split(' ')
        // console.log(name)
        $.ajax({

            url: "{% url 'get_vendordet' %}", 

            data: { 
                    fname : na[0],
                    lname : na[1],
                    id :na[2],
                    csrfmiddlewaretoken: '{{ csrf_token }}' 
                },

            type : 'POST',

            success: function(data) {
              console.log(data.vendor_email);
                $("#email_lbl").removeClass('d-none');
                $("#email_lbl").addClass('d-block');
                $("#gstin_lbl").removeClass('d-none');
                $("#gstin_lbl").addClass('d-block');
                $("#gst_trt_lbl").removeClass('d-none');
                $("#gst_trt_lbl").addClass('d-block');

                $('#email_lbl').text('Email : '+ data.vendor_email);
                $('#gstin_lbl').text('GSTIN  : '+ data.gst_number);
                $('#gst_trt_lbl').text('GST Treatment : ' +data.gst_treatment);

            }
        });
    
    });
});

$(document).ready(function() {
    $('#customer').change(function() {

        var name = $("#customer").val();
        var na = name.split(' ')
        console.log(name)
        $.ajax({

            url: "{% url 'get_customerdet' %}", 

            data: { 
                    name : na[0]+ " " + na[1],
                    id :na[2],
                    csrfmiddlewaretoken: '{{ csrf_token }}' 
                },

            type : 'POST',

            success: function(data) {
              console.log(data.customer_email);
                $("#cemail_lbl").removeClass('d-none');
                $("#cemail_lbl").addClass('d-block');
                $("#comp_lbl").removeClass('d-none');
                $("#comp_lbl").addClass('d-block');
                $("#cgst_trt_lbl").removeClass('d-none');
                $("#cgst_trt_lbl").addClass('d-block');
                $('#cemail_lbl').text('Email : '+ data.customer_email);
                $('#comp_lbl').text('Company Name  : '+ data.comp);
                $('#cgst_trt_lbl').text('GST Treatment : ' +data.gst_treatment);

            }
        });
    
    });
});




  $(document).ready(function(){
    var roinc = 0
    $('#add').click(function(){
      roinc++
      $('#items-table-body').append(
        
        `<tr id='addr0${roinc}'>
          <td style="width: 20%;">
            <div class="d-flex">
              <select name='item[]' id="item${roinc}" class="form-control">
                <option value=" " selected disabled>Select Item</option>
                {% for i in item %}
                  {% if i.cid_id == cmp1.cid %}
                      <option value="{{ i.name  }}">{{ i.name  }} </option>
                  {% endif %}
                {% endfor %}
              </select>
            </div>  
          </td>
          <td  style="width: 20%;">
            <div class="d-flex">
              <select name='account[]' id="account${roinc}" class="form-control">
                <option value=" " selected disabled >Select Account</option>
                <hr>
                {% for i in account %}
                  <option value="{{ i.accountName }}">{{ i.accountName  }} </option>
                {% endfor %}
              </select>
            </div>  
          </td>
          <td style="width: 10%;">
            <input type="number" name='qty[]' onchange="qtychange1(this)" placeholder='Qty' id="qty1${roinc}"  class="form-control qty" step=0 min=0/>
          </td>
          <td style="width: 10%;">
            <input type="text" name='rate[]' id="rate${roinc}" placeholder='Rate' class="form-control" />
          </td>
          <td style="width: 16%;">
            <select name="tax[]" id="tax1" class="form-control tax">
              <option id="ta${roinc}" value=0 text={{ cmp1.state }} disabled>Choose</option>
              <option value=28 text={{ cmp1.state }}>28.0% GST(28%)</option>
              <option value=18 text={{ cmp1.state }}>18.0% GST(18%)</option>
              <option value=12 text={{ cmp1.state }}>12.0% GST(12%)</option>
              <option value=6 text={{ cmp1.state }}>06.0% GST(06%)</option>
              <option value=5 text={{ cmp1.state }}>05.0% GST(05%)</option>
              <option value=3 text={{ cmp1.state }}>03.0% GST(03%)</option>
              <option value=.25 text={{ cmp1.state }}>0.25% GST(0.25%)</option>
              <option value=0 text={{ cmp1.state }}>0.0% GST(0%)</option>
              <option value=0 text={{ cmp1.state }}>Exempt GST(0%)</option>
              <option value=0 text={{ cmp1.state }}>Out of Scope(0%)</option>
              <option id="ta5${roinc}" value=0 text=" " disabled>Choose</option>
              <option value=28 text=" ">28.0% IGST(28%)</option>
              <option value=18 text=" ">18.0% IGST(18%)</option>
              <option value=12 text=" ">12.0% IGST(12%)</option>
              <option value=6 text=" ">06.0% IGST(06%)</option>
              <option value=5 text=" ">05.0% IGST(05%)</option>
              <option value=3 text=" ">03.0% IGST(03%)</option>
              <option value=.25 text=" ">0.25% IGST(0.25%)</option>
              <option value=0 text=" ">0.0% IGST(0%)</option>
              <option value=0 text=" ">Exempt IGST(0%)</option>
              <option value=0 text=" ">Out of Scope(0%)</option>
            </select>
          </td>
          <td style="width: 11%;">
            <input type="text" name='discount[]' id="discount${roinc}" placeholder='Discount' class="form-control"/>
          </td>
          <td style="width: 11%;">
            <input type="text" name='amount[]' id="amount${roinc}" placeholder='Amount' class="form-control price" step="0.00" min="0"  />
          </td>
          <td style="display: none;">
            <input type="number" step="any" name='taxamount1' id="taxamount1" class="form-control taxamount"/>
          </td>   
          <td><button type="button" id="${roinc}" class="btn btn-danger remove_row" tooltip="Remove">x</button></td>
        </tr>`

     
        );
      });
  });

  $(document).on('click','.remove_row',function(){
    var row_id = $(this).attr("id");
    $('#addr0'+row_id+'').remove();
  });

</script>

{% endblock %}