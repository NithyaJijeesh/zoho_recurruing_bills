{% extends 'base.html' %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">



<style>
    #details-list {
        float: left;
        width: 30%;
        background-color:rgb(25, 26, 27);
        
    }
    
    #quick-template {
        float: left;
        width: 70%;
    }
    a{
        list-style: none;
        color: azure;
    }
    a:hover{
    color: rgb(218, 164, 48);
    }
    li{
        list-style: none;
    }
    .card{
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        /* overflow-y: none;  */
        overflow: auto;
        background-color: transparent;
    }
    .containerprof{
        min-height: 450px;
        background-size: contain;
    }

    .tab {
        overflow: hidden;
        /* border: 1px solid ; */
        background-color: transparent;
        width: 300px;
    }

    .tab a {

        font-family: inherit;
        background-color: inherit;
        float: left;
        outline: none;
        cursor: pointer;
        padding: 10px 5px;
        transition: 0.3s;
        color: azure;
        border:none;
    }

    .tab a:hover {
        background-color: #ddd;
        color: rgb(56, 54, 54);
    }

    .tab a.active {
        background-color: #ccc;
        color: rgb(56, 54, 54);

    }

    .tabcontent {
        display: none;
        padding: 6px 12px;
        border-top: none;
    }
    .page {
        background: azure;
        display: block;
        margin: 0 auto;
        position: relative;
        box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
    }
    .page[size="A4"] {
        width: 17cm;
        height: 23cm;
        overflow: hidden;
    }
    td{
        color: rgba(0, 0, 0, 0.5);
    }
        
</style>

<div class="container-fulid containerprof">
  <div id="details-list" style="border-right: 0.5px solid; color: dimgray; line-height: auto;" class="vh-100">
    <div class="card radius-5">
        <div class="card-body">
            <div class="card-title">
                <div class="row p-3">
                    <div class="col-md-8">
                        <h5 class="mb-0 text-uppercase text-right">Recurring Bills</h5>
                    </div>
                    <div class="col-md-1 ">
                        <a href="{% url 'add_recurring_bills' %}" class="btn btn-primary fa fa-plus text-right px-3 py-1" 
                        role="button" ></a> 
                    </div>
                    <div class="col-md-1"></div>
                    <div class="col-md-1 ml-1">
                        <a class="btn text-center btn-primary fa fa-filter px-3 py-1" data-toggle="dropdown" role="button">
                        </a>
                        <div class="dropdown-menu ">
                            <a class="dropdown-item" href="{% url 'recurring_bill' %}">All</a>
                            <a class="dropdown-item" href="{% url 'recur_custasc' %}">Customer A-Z</a>
                            <a class="dropdown-item" href="{% url 'recur_custdesc' %}">Customer Z-A</a>
                            <a class="dropdown-item" href="{% url 'recur_vendorasc' %}">Vendor A-Z</a>
                            <a class="dropdown-item" href="{% url 'recur_vendordesc' %}">Vendor Z-A</a>
                            <a class="dropdown-item" href="{% url 'recur_profileasc' %}">Profile A-Z</a>
                            <a class="dropdown-item" href="{% url 'recur_profiledesc' %}">Profile Z-A</a>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card radius-5 mb-5">
        <div class="card-body" >
            <div class="row mt-1">
                <ul>
                    {% for b in recur_bills %}
                    <li class="p-2 text-capitalize font-weight-bold" id="link_details" onclick="showDetails()">
                        <a href="{% url 'view_recurring_bills' b.id %}" > {{b.profile_name}} </a> <br>
                        <label class="px-5 mt-2 mx-4 input-group " disabled>â‚¹ {{ b.grand_total }} </label>
                    </li><hr>
                    {% endfor %}
                    
                </ul> 
            </div>
        </div>
    </div>
  </div>
  <div class="quick-template ">
    <div class="card radius-15 " style="border-bottom: 0.5px double #ccc;">
        <div class="card-body">
            <div class="card-title">
                <h3 class="mb-0" id="prof_name">{{recur_bill.profile_name}}</h3>
            </div>
        
            <div class="btn-group" style="float: right; ">
                <a href="" class=" far fa-comment-alt" style="padding: 10px; cursor: pointer;" data-toggle="tooltip" title="ADD COMMENTS"> </a>
                <div class=" input-group mx-4">
                    <a href="{% url 'edit_recurring_bills' recur_bill.id %}" class=" fa fa-pencil" style="padding: 10px; cursor: pointer;" data-toggle="tooltip" title="EDIT"> </a>
                    <a  href="{% url 'delete_recurring_bills' recur_bill.id %} " class="delete fa fa-trash" style="padding: 10px; cursor: pointer;" data-toggle="tooltip" title="DELETE"> </a>                
                </div>
                <a href="" class="fa fa-file-pdf" style="padding: 10px; cursor: pointer;" data-toggle="tooltip" title="PDF"></a>
                <a href="" class=" fa fa-print" style="padding: 10px; cursor: pointer;" data-toggle="tooltip" title="PRINT"> </a>
                <a  href=" " class="fa fa-envelope" style="padding: 10px; cursor: pointer;" data-toggle="tooltip" title="MAIL"> </a>
                <a href=" " class=" fas fa-paperclip" style="padding: 10px; cursor: pointer;" data-toggle="tooltip" title="ATTACH"> </a>
            </div>

            <div class="tab">
                <a class="tablinks  mx-2" onclick="openTab(event, 'Template')" role="button"><i class="fa fa-file-word"></i> Template</a>
                <a class="tablinks " onclick="openTab(event, 'Overview')" role="button"><i class="fa fa-eye"></i> Overview</a>
            </div>
        </div>
    </div> 
    
    
    <div id="Template" class="tabcontent p-2 mx-5" style="display: block;">
        <div  id="toPrint">
            <div class="my-5 page" size="A4" >
                <div class="p-5">
                    <div id="ember2512" class="tooltip-container ember-view ribbon text-ellipsis">
                        <div class="ribbon-inner ribbon-open">Draft<!----></div>
                    </div>
                    <section class="top-content bb d-flex justify-content-between">
                        <div class="top-left">
                            <div class="graphic-path">
                                <h5 style="color: black;">{{recur_bill.profile_name}}</h5>
                            </div>
                            <div class="position-relative">
                                <p style="color: black;">Bill No. <span>{{recur_bill.id }}</span></p>
                            </div>
                        </div>
                    </section>
        
                    <section class="store-user mt-5">
                        <div class="col-12">
                            <div class="row bb pb-3">
                                <div class="col-7">
                                    <p style="color: black;">FROM,</p>
                                    <h5 style="color: black;">{{company.company_name }}</h5>
                                    <p class="address " style="color: black;"> {{company.address}}<br>
                                        {{company.city}}
                                        {{company.state}}<br>
                                        {{company.pincode}}<br>
                                    </p>
                                </div>
                                <div class="col-5">
                                    <p style="color: black;">TO,</p>
                                    <h5 style="color: black;">{{recur_bill.customer}}</h5>
                                    <p class="address col-6" style="margin-left: -14px;color: black;" > {{ recur_bill.billingaddress}} </p>
                                    
                                </div>
                            </div>
                            <div class="row extra-info pt-3">
                                <div class="col-7">
                                    <p style="color: black;">Start Date: <span style="color: black;">{{recur_bill.start_date | date:'d-m-Y'}}</span></p>
                                </div>
                                <div class="col-5">
                                    <p style="color: black;">End Date : <span style="color: black;">{{recur_bill.end_date | date:'d-m-Y'}}</span></p>
                                </div>
                            </div>
                        </div>
                    </section>
        
                    <section class="product-area mt-4">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <td>Item &nbsp;&nbsp; Account</td>
                                    <td>Price</td>
                                    <td>Quantity</td>
                                    <td>Discount</td>
                                    <td>Tax</td>
                                    <td>Total</td>
                                </tr>
                            </thead>
                            <tbody>

                                {% for b in bill_item %}
                                <tr>
                                    <td>{{b.item}} &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;   {{b.account}} </td>
                                    <td >{{b.rate}}</td>
                                    <td >{{b.quantity}}</td>
                                    <td >{{b.discount}}</td>
                                    <td >{{b.tax}} %</td>
                                    <td >{{b.amount}}</td>
                                </tr>
                                {% endfor %}
  
                            </tbody>
                        </table>
                    </section>
        
                    <section class="balance-info p-5">
                        <div class="row">
                            <div class="col-8 btn-group">
                                <p class="m-0 font-weight-bold" style="color: black;"> Note: </p>
                                <p class="py-0 px-5" style="color: black;">{{recur_bill.note}}</p>
                            </div>
                            <div class="col-4">
                                <table class="table border-0 table-hover">
                                    <tr >
                                        <td style="font-weight:bold">Sub Total :</td>
                                        <td style="font-weight:bold">{{recur_bill.sub_total}}</td>
                                    </tr>
                                    {% if recur_bill.IGST != "" %}
                                    <tr>
                                        <td style="font-weight:bold">IGST :</td>
                                        <td style="font-weight:bold">{{recur_bill.igst}}</td>
                                    </tr>
                                    {% endif %}
                                    {% if recur_bill.CGST != "" %}
                                    <tr>
                                        <td style="font-weight:bold">CGST :</td>
                                        <td style="font-weight:bold">{{recur_bill.cgst}}</td>
                                    </tr>
                                    {% endif %}
                                    {% if recur_bill.SGST != "" %}
                                    <tr>
                                        <td style="font-weight:bold">SGST:</td>
                                        <td style="font-weight:bold">{{recur_bill.sgst}}</td>
                                    </tr>
                                    {% endif %}
                                    <tfoot>
                                        <tr>
                                            <td style="font-weight:bold">Total:</td>
                                            <td style="font-weight:bold ;">{{recur_bill.grand_total}}</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </section>
    
                </div>
            </div>
        </div> 
    </div>
    

    <!-- overview -->
    <div id="Overview" class="tabcontent">
    
    </div>
      

      
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>


<script>


    function showDetails(){

            var billid = $('#id_details').val();
            $.ajax({
                url:"",
                type:"POST",
                data: {
                    id : billid,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                   
                },
                success: function (data) {
                    console.log("success");
                    console.log(data);
                    $("#prof_name").text(data[0]);
                    
                }
            
            });
    } 

    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");

        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }

        tablinks = document.getElementsByClassName("tablinks");

        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }

        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";
    }


    $('.delete').click(function(event) {
            var form =  $(this).closest("form");
            var name = $(this).data("name");
            event.preventDefault();
            swal({
                title: `Are you sure you want to delete this record?`,
                text: "If you delete this, it will be gone forever.",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            })
            .then((willDelete) => {
                if (willDelete) {
                    swal("Poof! Your imaginary file has been deleted!", {
                    icon: "success" ,
              
                    });
                    form.submit();
        
                    
                    
                    
                    }
            });
        });
</script>

{% endblock %}